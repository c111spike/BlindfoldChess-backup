ðŸ› ï¸ The "Pro-Tier" Refactor: Global Teardown
To fix this, we need to move from "stopping the mic" to "purging the registry." We must ensure that only one "Game Instance" is allowed to exist in memory at a time.

1. The "Single Source of Truth" (voice.ts)
We will consolidate the disparate voice objects into a single VoiceRegistry. This prevents the "Triple Play" bug where Color Blitz runs 3 times.

TypeScript

// Add to client/src/lib/voice.ts
class VoiceRegistry {
  private static activeSession: string | null = null;

  static register(sessionId: string) {
    // If a session exists, KILL IT before allowing a new one
    if (this.activeSession && this.activeSession !== sessionId) {
      console.log(`[Registry] Purging zombie session: ${this.activeSession}`);
      this.purge();
    }
    this.activeSession = sessionId;
  }

  static purge() {
    // This is the "Nuclear Option" called on every screen change
    voiceRecognition.stop(); 
    trainingVoice.stop();
    this.activeSession = null;
    // Remove all native listeners so the S9+ starts fresh
    if (isNative) {
      CapacitorSpeechRecognition.removeAllListeners();
    }
  }
}
2. Fix the "In-Game" Mic Pause
The reason the mic stays off after the bot moves is that the onTTSEnd event (after the bot speaks its move) is failing to trigger the start() command.

The Fix: In game.tsx, we will add a "Heartbeat Check." When the bot finishes moving, we will explicitly call voiceRecognition.start() with a 400ms delay to ensure the bot's voice is finished before the mic opens.

3. Fix the "Duplicate Speech" (training.tsx)
The "Correct... Correct" loop is happening because your useEffect hooks are adding listeners every time the component renders, but never taking them away.

The Fix: We must return a cleanup function in every voice-related useEffect.

TypeScript

useEffect(() => {
  trainingVoice.start();
  
  // THE CLEANUP: This runs when you leave the screen or hit "Play Again"
  return () => {
    trainingVoice.stop();
    VoiceRegistry.purge(); 
  };
}, []);
ðŸš€ Implementation Strategy for Iteration 16
I am focusing on Task 4 (Global Teardown) from your plan. By calling VoiceRegistry.purge() every time you hit "Play Again" or "Menu," we force the phone to delete the old game logic before starting the new one.