This is the definitive checklist to break the cycle of stale builds and hardware deadlocks. By decoupling the UI from the hardware state and implementing the "Stealth Mic" window, we are finally forcing the software to respect the S9+'s physical limitations.

üõ†Ô∏è The "Bulletproof" Logic Update
I've consolidated your tasks into the specific code implementation for Task 1 and Task 2. This ensures the "Safety Timeout" is the first thing that hits the codebase.

Task 1 & 2: voice.ts - The Master Engine Reset
TypeScript

// Inside VoiceMasterEngine in client/src/lib/voice.ts
private isMuted: boolean = false;
private muteTimeout: ReturnType<typeof setTimeout> | null = null;

mute(durationMs: number = 400) {
  this.isMuted = true;
  if (this.muteTimeout) clearTimeout(this.muteTimeout);
  this.muteTimeout = setTimeout(() => {
    this.isMuted = false;
    this.muteTimeout = null;
  }, durationMs);
}

async stopAndWait(): Promise<void> {
  this.shouldBeListening = false;

  const forceCleanup = () => {
    this.micBusy = false;
    this.isListening = false;
    this.consecutiveFailures = 0;
    this.stopResolver = null;
    this.onListeningChange?.(false);
    console.log("[Voice] Force Cleanup Executed: State Purged.");
  };

  try {
    // Race hardware against 300ms timeout
    await Promise.race([
      this.stop(),
      new Promise((_, reject) => 
        setTimeout(() => reject(new Error("Timeout")), 300)
      )
    ]);
  } catch (e) {
    console.warn("[Voice] stopAndWait timed out, forcing unlock.");
  } finally {
    forceCleanup();
  }
}
üìÇ Task 5 & 6: Non-Blocking UI Implementation
In client/src/pages/training.tsx, you must ensure that navigation and game-state buttons no longer "wait" for the mic. This prevents the "Frozen Menu" issue.

The Change: Remove await before stopAndWait().

The Logic: You want to fire the stop command, but let the UI change screens immediately. The forceCleanup in voice.ts will handle the background cleanup while the user is already looking at the menu.

üöÄ Task 8: The Rebuild Sequence (Crucial)
Since we now know Iterations 11‚Äì15 were testing stale code, this sequence is the most important part of your day. Do not skip the patch script.

Clean the slate: rm -rf android/app/build (Optional but recommended to clear Gradle cache).

Web Build: npm run build.

Capacitor Sync: npx cap sync android.

The Fix Script: node scripts/patch-capacitor-android.cjs (This ensures the S9+ specific intent flags are injected into the native code).

Compile: cd android && ./gradlew assembleDebug.

Checking the APK Size
Stale APK Check: If the resulting APK is exactly the same byte size as your previous one, something went wrong in the npm run build step.

Valid APK: Expect a size around 30MB to 35MB.