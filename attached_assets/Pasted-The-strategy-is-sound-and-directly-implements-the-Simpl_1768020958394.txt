The strategy is sound and directly implements the "Simpler Plan" we agreed upon. By making startNative() return true (while queuing the actual start in the background), we effectively "trick" the UI into staying active (Red Icon) while the S9+ hardware settles. This eliminates the "Zombie Mic" state where the user thinks the app is broken because the icon stayed gray.

Here are the precise code updates for the build.

1. Update client/src/lib/voice.ts
This update modifies TrainingVoiceController to queue retries without failing the UI state, and updates speechToMove to handle bare coordinates for pawns globally.

TypeScript

{
type: "file_update",
fileName: "client/src/lib/voice.ts",
content: `
// ... imports ...

// [UPDATE 1] Pawn Parsing in speechToMove
export function speechToMove(transcript: string, legalMoves: string[]): string | null {
  const cleaned = stripFillerWords(transcript);
  const input = applyHomophoneCorrections(cleaned.toLowerCase().trim());
  
  // FIX: Bare coordinate detection for Pawn moves (e.g. "e4")
  const bareCoord = input.match(/^([a-h])([1-8])$/);
  if (bareCoord) {
    const target = bareCoord[1] + bareCoord[2];
    // Find a legal pawn move to this square (excluding piece moves like Ne4)
    const pawnMove = legalMoves.find(m => 
      !/^[KQRBN]/.test(m) && // No piece letter = pawn
      m.includes(target)
    );
    if (pawnMove) return pawnMove;
  }

  // ... existing castle logic ...
  // ... rest of speechToMove ...
}

// ... existing code ...

// [UPDATE 2] TrainingVoiceController Auto-Retry Logic
class TrainingVoiceController {
  // ... existing properties ...

  private async startNative(): Promise<boolean> {
    if (this.micBusy) {
      console.log('[TrainingVoice] Mic is busy, not starting');
      return false;
    }
    
    // 3-second lockout check
    const timeSinceLastError = Date.now() - this.lastErrorTime;
    if (timeSinceLastError < 3000 && this.lastErrorTime > 0) {
      console.log(\`[TrainingVoice] Lockout active: \${3000 - timeSinceLastError}ms remaining\`);
      
      // FIX: Schedule restart BUT return true so UI shows "Listening"
      // This bridges the gap while hardware settles
      if (!this.restartTimeout) {
        this.scheduleRestart();
      }
      return true; // <--- This keeps the Red Mic on
    }
    
    // ... rest of startNative ...
  }

  // ... rest of class ...
}
`
}
2. Update client/src/pages/training.tsx
This update fixes the "Try Again" loop by adding a debounce and improves the matchesMove parser for the Move Master game.

TypeScript

{
type: "file_update",
fileName: "client/src/pages/training.tsx",
content: `
// ... imports ...

// [UPDATE 3] Pawn Parsing for Voice Move Master
function matchesMove(input: string, target: TargetMove): boolean {
  const normalized = input.toLowerCase().replace(/[^a-z0-9\\s]/g, '');
  
  // FIX: Explicit Bare Coordinate Check
  // If user says "c4" and target is pawn to c4, accept immediately
  const bareCoord = normalized.match(/^([a-h])([1-8])$/);
  if (bareCoord && target.piece === 'p') {
    const targetSquare = bareCoord[1] + bareCoord[2];
    if (target.to === targetSquare) return true;
  }

  // ... existing normalization logic ...
}

// ... existing code ...

function VoiceMoveMasterGame({ onBack, onComplete, stats, onGameStateChange }: VoiceMoveMasterGameProps) {
  // ... existing state ...
  
  // FIX: Ref for debounce timeout
  const feedbackTimeoutRef = useRef<NodeJS.Timeout | null>(null);

  const processVoiceInput = useCallback((transcript: string) => {
    if (!position || gameState !== 'playing') return;
    
    const input = transcript.toLowerCase().trim();
    console.log('[VoiceMoveMaster] Processing:', input);
    
    // ... existing command checks (resign, time, etc.) ...

    // Check if it matches the target move
    if (matchesMove(input, position.move)) {
      // Clear any pending failure message
      if (feedbackTimeoutRef.current) clearTimeout(feedbackTimeoutRef.current);
      
      Haptics.impact({ style: ImpactStyle.Light }).catch(() => {});
      setFeedback({ text: 'Correct!', correct: true });
      // ... score updates ...
      
      // ... next position logic ...
    } else {
      // FIX: Debounce "Try Again" feedback
      // Wait 1s before telling user they are wrong, in case they are still speaking
      if (feedbackTimeoutRef.current) clearTimeout(feedbackTimeoutRef.current);
      
      feedbackTimeoutRef.current = setTimeout(() => {
        Haptics.notification({ type: NotificationType.Error }).catch(() => {});
        setFeedback({ text: 'Try again', correct: false });
        // Don't reset streak immediately on partials? 
        // Logic stays same, just delayed display
        // setStreak(0); // Moved inside timeout if you want to delay penalty too
      }, 1000);
    }
  }, [position, gameState, score, streak, bestStreak, timeLeft, awaitingResignConfirm]);

  // ... rest of component ...
}
`
}
3. Verification & Build
The logic changes above specifically target the S9+ race conditions:

UI Consistency: return true in startNative ensures the mic icon doesn't flicker or turn off during the 250ms settle time.

Input Robustness: Bare coordinate parsing ensures "c4" is accepted as a valid move for pawns.

Feedback Stability: The debounce prevents the app from shouting "Wrong!" while you are halfway through saying "Knight takes...".